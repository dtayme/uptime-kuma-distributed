# CVE Remediation Notes (Docker Builds)

This document maps Docker build changes to CVEs reported by Docker Scout in the alpha images.
Source reports (latest pulled):

- `tmp/scout-reports/scout-alpha/scout-alpha.sarif.json`
- `tmp/scout-reports/scout-poller-alpha/scout-poller-alpha.sarif.json`

## Changes Implemented

1. Go healthcheck builder updated to patched Go toolchain.
2. Runtime images remove `npm`, `npx`, and `corepack` (build stage still has npm).
3. Apprise/Python handling:
   Option A installs Apprise and `paho-mqtt` via pip (Apprise pinned by `APPRISE_PIP_VERSION`) and upgrades Python deps.
   Option B allows disabling Apprise (and Python) via build arg `ENABLE_APPRISE=0`.
4. Poller base image split into `base2-poller` to reduce runtime surface area.
5. Healthcheck builder updated to Go 1.23.8 and NodeSource 22.x, with cleanup of build-only packages.
6. Healthcheck sources moved under `extra/healthcheck-src` and builder image now copies only that directory.
7. Apprise dependency upgrades via pip to address `cryptography`/`urllib3` CVEs.
8. Poller base image now removes Apprise/Python and cloudflared to minimize runtime packages.
9. Build Apprise/pip dependencies in a dedicated stage (arm/v7 build deps included) and copy only runtime artifacts into base images.

## CVE Mapping

Change: Update Go toolchain for healthcheck build
Packages: `pkg:golang/stdlib@1.20.5` (healthcheck binary)
CVEs addressed (from Scout):

- CVE-2022-30635, CVE-2023-29406, CVE-2023-29409, CVE-2023-39318, CVE-2023-39319, CVE-2023-39325, CVE-2023-39326, CVE-2023-44487, CVE-2023-45283, CVE-2023-45284, CVE-2023-45288, CVE-2023-45289, CVE-2023-45290, CVE-2024-24783, CVE-2024-24784, CVE-2024-24785, CVE-2024-24789, CVE-2024-24790, CVE-2024-24791, CVE-2024-34155, CVE-2024-34156, CVE-2024-34158, CVE-2024-45336, CVE-2024-45341, CVE-2025-0913, CVE-2025-22866, CVE-2025-22871, CVE-2025-22873, CVE-2025-4673, CVE-2025-47906, CVE-2025-47912, CVE-2025-58183, CVE-2025-58185, CVE-2025-58186, CVE-2025-58187, CVE-2025-58188, CVE-2025-58189, CVE-2025-61723, CVE-2025-61724, CVE-2025-61725, CVE-2025-61726, CVE-2025-61727, CVE-2025-61728, CVE-2025-61729, CVE-2025-61730, CVE-2025-68121
  Notes: These are tied to the Go stdlib version embedded in the healthcheck binary. Rebuild required to confirm removals.

Change: Remove npm from runtime images
Packages: `pkg:npm/npm@10.9.4`, `pkg:npm/tar@6.2.1`, `pkg:npm/tar@7.4.3`, `pkg:npm/glob@10.4.5`
CVEs addressed (from Scout):

- CVE-2026-0775 (npm)
- CVE-2026-23745, CVE-2026-23950, CVE-2026-24842 (tar)
- CVE-2025-64756 (glob)
  Notes: Build stages still use npm; runtime stages do not include npm after this change.

Change: Install Apprise via pip (Option A)
Packages: `pypi:apprise`, `pypi:cryptography`, `pypi:urllib3`, `pypi:certifi`
CVEs addressed (from Scout):

- CVE-2022-23491, CVE-2023-37920, CVE-2024-39689 (certifi)
- CVE-2023-0286
- CVE-2023-43804
- CVE-2023-50782
- CVE-2024-26130
- CVE-2025-66418
- CVE-2025-66471
- CVE-2026-21441
  Notes: Performed with `pip install --break-system-packages` during the Apprise install step. This removes Debian `python3-*` dependency packages from the image. Rebuild and re-scan to confirm removal.

Change: Apprise disabled (Option B)
Packages: `pkg:deb/debian/python3.11@3.11.2-6+deb12u6` and `pkg:deb/debian/python-certifi@2022.9.24-1`
CVEs removed by exclusion (from Scout):

- CVE-2025-11468, CVE-2025-12781, CVE-2025-15282, CVE-2025-15366, CVE-2025-15367, CVE-2026-0672 (python3.11)
- CVE-2022-23491, CVE-2023-37920, CVE-2024-39689 (certifi)
  Notes: Requires building with `ENABLE_APPRISE=0`. This removes Python from the image, so Apprise-based notifications are unavailable.

Change: Update cloudflared binary to 2026.2.0
Packages: `pkg:golang/github.com/coredns/coredns@1.12.2`, `pkg:golang/github.com/go-chi/chi@5.2.2#v5`
CVEs addressed (from Scout):

- CVE-2025-58063, CVE-2025-68151 (coredns)
- GHSA-mqqf-5wvp-8fh8 (chi)
  Notes: The cloudflared binary bundles these Go dependencies. A newer cloudflared release should update them; re-scan required to confirm. Base images now download cloudflared from the repo release assets.

How to build patched cloudflared:

- Workflow: run `Build Cloudflared (Patched)` with `tag` and `module_overrides`, which publishes assets under `cloudflared-<tag>`.
- Local: `node extra/build-cloudflared.mjs --tag 2026.2.0 --goos linux --goarch amd64 --out dist/cloudflared-linux-amd64 --module golang.org/x/crypto@v0.43.0`.

Change: Update healthcheck builder Go toolchain to 1.23.8
Packages: `pkg:golang/stdlib@1.22.12`
CVEs addressed (from Scout):

- CVE-2025-22871
- CVE-2025-58187, CVE-2025-58188
- CVE-2025-61723, CVE-2025-61725, CVE-2025-61726, CVE-2025-61729
  Notes: These were still present in the latest Scout run (Go stdlib 1.22.12). Rebuild and re-scan to confirm removal.

Change: Reduce healthcheck build context (copy only `extra/healthcheck-src`)
Notes: This limits the builder image context to just healthcheck sources and prevents unrelated helper scripts from being included in the builder image.

Change: Introduce `base2-poller` (minimal poller base)
Packages removed from poller runtime: Chromium, MariaDB, and related fonts packages.
CVEs addressed (from Scout):

- No explicit CVE IDs were tied to these packages in the latest Scout outputs.
  Notes: This change is intended to reduce the poller attack surface and should remove any future CVEs tied to those packages. Re-scan to confirm deltas.

Change: Remove Apprise/Python and cloudflared from poller runtime
Packages removed from poller runtime: `apprise`, Python runtime/libs, cloudflared binary.
CVEs addressed (from Scout):

- CVE-2023-0286, CVE-2023-50782, CVE-2024-26130 (cryptography)
- CVE-2023-43804, CVE-2025-66418, CVE-2025-66471, CVE-2026-21441 (urllib3)
- CVE-2022-23491, CVE-2023-37920, CVE-2024-39689 (certifi)
- CVE-2025-58063 (cloudflared bundled coredns)
  Notes: These were present in the poller image due to shared base layers. Rebuild and re-scan to confirm removal from poller artifacts.

## Build Args and Targets

- `ENABLE_APPRISE=1` (default) keeps Apprise/Python and installs patched certs/libs.
- `ENABLE_APPRISE=0` removes Apprise/Python from base images.
- `APPRISE_PIP_VERSION` pins the Apprise version installed via pip.
- Runtime images are built from `base2` which now removes npm.

## Verification Steps

1. Rebuild base images (`base2-build`, `base2-runtime`, `base2`) with desired `ENABLE_APPRISE` value.
2. Rebuild runtime images and re-run Docker Scout.
3. Validate that the CVE list for the packages above is reduced or eliminated in the SARIF outputs.

## Latest Scout Results (Run 21736991699, 2026-02-06)

Report sources:

- `tmp/scout-reports/run-21736991699/scout-alpha/scout-alpha.sarif.json`
- `tmp/scout-reports/run-21736991699/scout-poller-alpha/scout-poller-alpha.sarif.json`

Central remaining counts: critical 1, high 15, medium 32, low 109, unspecified 8.  
Poller remaining counts: high 10, medium 22, low 42, unspecified 6.

Central top packages by CVE count: `golang:stdlib (21)`, `deb:debian/tiff (16)`, `pypi:cryptography (10)`, `deb:debian/openjpeg2 (9)`, `deb:debian/llvm-toolchain-15 (9)`, `deb:debian/glibc (7)`, `deb:debian/elfutils (7)`, `pypi:urllib3 (7)`, `deb:debian/python3.11 (6)`, `deb:debian/systemd (4)`.  
Poller top packages by CVE count: `pypi:cryptography (10)`, `deb:debian/glibc (7)`, `pypi:urllib3 (7)`, `deb:debian/python3.11 (6)`, `golang:stdlib (4)`, `deb:debian/systemd (4)`, `deb:debian/krb5 (3)`, `deb:debian/sqlite3 (3)`, `deb:debian/python-certifi (3)`, `pypi:certifi (3)`.

Central high/critical CVEs and packages:
| CVE | Package |
| --- | --- |
| CVE-2023-0286 | `pypi:cryptography@38.0.4` |
| CVE-2023-43804 | `pypi:urllib3@1.26.12` |
| CVE-2023-50782 | `pypi:cryptography@38.0.4` |
| CVE-2024-26130 | `pypi:cryptography@38.0.4` |
| CVE-2025-22871 | `golang:stdlib@1.22.12` |
| CVE-2025-47913 | `golang:golang.org/x/crypto@0.38.0` |
| CVE-2025-58063 | `golang:github.com/coredns/coredns@1.12.2` |
| CVE-2025-58187 | `golang:stdlib@1.22.12` |
| CVE-2025-58188 | `golang:stdlib@1.22.12` |
| CVE-2025-61723 | `golang:stdlib@1.22.12` |
| CVE-2025-61725 | `golang:stdlib@1.22.12` |
| CVE-2025-61726 | `golang:stdlib@1.22.12`, `golang:stdlib@1.24.11` |
| CVE-2025-61729 | `golang:stdlib@1.22.12` |
| CVE-2025-66418 | `pypi:urllib3@1.26.12` |
| CVE-2025-66471 | `pypi:urllib3@1.26.12` |
| CVE-2026-21441 | `pypi:urllib3@1.26.12` |

Poller high/critical CVEs and packages:
| CVE | Package |
| --- | --- |
| CVE-2023-0286 | `pypi:cryptography@38.0.4` |
| CVE-2023-43804 | `pypi:urllib3@1.26.12` |
| CVE-2023-50782 | `pypi:cryptography@38.0.4` |
| CVE-2024-26130 | `pypi:cryptography@38.0.4` |
| CVE-2025-47913 | `golang:golang.org/x/crypto@0.38.0` |
| CVE-2025-58063 | `golang:github.com/coredns/coredns@1.12.2` |
| CVE-2025-61726 | `golang:stdlib@1.24.11` |
| CVE-2025-66418 | `pypi:urllib3@1.26.12` |
| CVE-2025-66471 | `pypi:urllib3@1.26.12` |
| CVE-2026-21441 | `pypi:urllib3@1.26.12` |
